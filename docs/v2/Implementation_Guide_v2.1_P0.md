# Implementation Guide V2.1 – P0  

## 概述  
本指南描述了 StockAI Trader V2.1 在 P0 阶段需要实现的核心模块、API 接口、数据流程以及前端路由规划，供后端与前端开发协同参考。  

## API 列表  
以下为 P0 阶段需要提供的接口：  

- `GET /api/v2/discover/themes-radar`  
  - **用途**：返回市场热点雷达信息，供“发现”页面展示。  
  - **查询参数**：`date`（可选，默认当前日期）。  
  - **返回数据**：包含行业涨跌榜、主题列表及涨跌幅、市场温度标签，以及当日领涨/领跌股票列表。  

- `GET /api/v2/stocks/:ticker/dashboard`  
  - **用途**：返回指定股票的综合仪表盘数据，供“看懂”页面使用。  
  - **路径参数**：`ticker`（股票代码）。  
  - **返回数据**：  
    - 公司快照（名称、市值、简介、当前价格及涨跌幅）  
    - 财务指标与估值分析（市值、收入、利润、EPS、PE/PS/PB 等，含行业对比与历史分位）  
    - 技术结构（短中期趋势、支撑阻力、波动率、强弱指标）  
    - 事件时间轴（财报发布、大新闻、异常涨跌日等）  
    - 证据级回测摘要（针对固定信号的胜率、平均收益、最大回撤等统计）  
    - AI 综合总结（模型生成的趋势倾向、风险与机会提示、置信度评级）  

- `POST /internal/backtest/evidence`  
  - **用途**：内部接口，用于触发轻量级回测以生成证据级统计，不对前端暴露。  
  - **请求体**：`ticker`、`signal_type`、`lookback_window`、`holding_period`。  
  - **返回数据**：回测统计的胜率、平均收益、最大回撤和样本数量等。  

## 主要数据流程  

1. **数据收集层**  
   - 使用现有的数据接入模块抓取行情、财报、主题标签及指数数据。  
   - 市场快照由 `MarketSnapshotService` 聚合行业涨跌、主题涨跌以及市场温度。  
   - 单股数据由 `FundamentalsService`、`TechnicalService`、`EventsService` 分别获取财务、技术和事件信息。  

2. **计算与分析层**  
   - `EvidenceBacktestService` 针对固定信号模板运行轻量级历史统计，输出胜率和收益分布，用作 AI 结论支撑。  
   - `StockAIReportService` 汇总上述服务的数据，构建结构化 JSON，并调用 LLM 模型生成 AI 综合总结、机会/风险列表与评级。  

3. **API 层**  
   - 提供统一的 REST 接口，将计算结果打包返回给前端。  
   - 对内部回测接口添加权限限制，仅供后端服务调用。  

4. **前端交互流程**  
   - 前端调用 `/api/v2/discover/themes-radar` 获取热点雷达数据，渲染行业榜、主题卡片和市场温度。  
   - 用户在热点页面点击某股票或主题后跳转至 `/stock/:ticker`。  
   - 前端调用 `/api/v2/stocks/:ticker/dashboard` 获取该股票的仪表盘数据，解析出基本面、技术面、事件、回测统计与 AI 总结并展示。  

## 前端路由规划  

- `/discover`  
  - **页面功能**：展示市场热点雷达，包括行业涨跌榜、主题卡片、领涨领跌股票列表以及市场温度标签。  
  - **组件布局**：  
    - 左侧：行业涨跌排名列表。  
    - 中间：热点主题卡片，每个主题展示代表性股票及涨跌幅。  
    - 右侧：市场温度及一段 AI 生成的简短点评。  
  - **交互**：点击主题或股票条目可跳转到对应股票仪表盘。  

- `/stock/:ticker`  
  - **页面功能**：展示单只股票的 AI 仪表盘。  
  - **组件布局**：  
    - 顶部栏：股票名称、当前价格、涨跌幅、市值及 AI 综合评级徽章。  
    - 左栏：公司快照及财务趋势图（收入、利润等）。  
    - 右栏：估值指标与技术指标卡片（包括趋势、支撑阻力、波动率）。  
    - 底部：事件时间轴与证据级回测结果摘要。  
    - 侧边栏或页尾：AI 综合总结文字、机会和风险要点。  

该指南旨在帮助开发者在 P0 阶段快速落地核心功能，后续迭代可在此基础上扩展更多策略、主题自动聚类以及互动分析能力。 
